<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Create a story with AI</title>
    <style>
        body {
            display: flex;
            justify-content: center;
            margin: 0;
            font-family: Arial, sans-serif;
        }

        .container {
            text-align: center;
        }

        div {
            margin: 10px 0;
        }

        .fruit-option {
            background-color: lightblue;
        }

        #story {
            border: 1px solid #ccc;
            padding: 5px;
            margin: 10px 0;
            min-height: 100px;
            resize: vertical;
            overflow-y: auto;
        }

    </style>
</head>

<body>
    <div class="container">
        <h2>Create a story with AI</h2>
        <div id="story">Choose between three AI-generated options to write your story.</div><br>
        <button id="option1" onclick="continueStory(this.textContent)" class="fruit-option" style="cursor: pointer;">apple </button>
        <button id="option2" onclick="continueStory(this.textContent)" class="fruit-option" style="cursor: pointer;">banana</button>
        <button id="option3" onclick="continueStory(this.textContent)" class="fruit-option" style="cursor: pointer;">mango</button>

        <div style="margin-top: 30px;">
            <h2>Ask AI about your fruit choice</h2>
            <textarea id="userInput" placeholder="Ask something about your favorite fruit..." style="width: 300px; height: 60px; margin: 10px 0;"></textarea><br>
            <button onclick="askAI()" style="padding: 10px 20px; cursor: pointer;">Ask AI</button>
            <div id="aiResponse" style="margin-top: 20px; padding: 10px; border: 1px solid #ddd; min-height: 50px; background-color: #f9f9f9; white-space: pre-wrap;"></div>
            <div id="loading" style="display: none; margin-top: 10px; color: #666;">Thinking...</div>
        </div>
    </div>
    <script>
        function continueStory(fruit) {
            const storyElement = document.getElementById('story');
            storyElement.textContent += fruit;
        }

        async function askAI() {
            const userInput = document.getElementById('userInput').value.trim();
            const selectedFruit = document.getElementById('story').textContent;

            if (!userInput) {
                alert('Please enter a question first!');
                return;
            }

            const loading = document.getElementById('loading');
            const responseDiv = document.getElementById('aiResponse');

            loading.style.display = 'block';
            responseDiv.textContent = '';

            try {
                const messages = [{
                        role: 'system',
                        content: 'You are a helpful assistant that answers questions about fruits and food.'
                    },
                    {
                        role: 'user',
                        content: selectedFruit ?
                            `My favorite fruit is ${selectedFruit}. ${userInput}` : userInput
                    },
                    {
                        role: 'assistant',
                        content: 'I see that your favorite fruit is'
                    }
                ];

                const response = await fetch('/api/openrouter', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        messages: messages,
                        model: 'meta-llama/llama-3.2-3b-instruct:free'
                    })
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error || 'Request failed');
                }

                const data = await response.json();
                const aiMessage = data.choices?.[0]?.message?.content || 'No response received';

                responseDiv.textContent = aiMessage;

            } catch (error) {
                console.error('Error:', error);
                responseDiv.textContent = `Error: ${error.message}`;
            } finally {
                loading.style.display = 'none';
            }
        }

        // Allow Enter key to submit
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('userInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    askAI();
                }
            });
        });

    </script>
</body>

</html>
